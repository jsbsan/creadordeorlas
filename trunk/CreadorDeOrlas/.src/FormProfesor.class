' Gambas class file

Public modo As Integer  'modo añadir=-1, editar=nº de id
Public anadir As Integer = -1
Public reg As New ClassProfesor

Public Sub Form_Open()
  
  Dim a As Integer
  
  If modo > -1 Then   
    If reg.foto <> "" And Exist(modulePrincipal.RutaPrograma & "temporales/FotosProfesores/" & reg.foto) Then 
      PictureBoxFoto.Tag = Replace$(reg.foto, " ", "_")
      PictureBoxFoto.Picture = Picture[modulePrincipal.RutaPrograma & "temporales/FotosProfesores/" & reg.foto]
    Else
      If Not Exist(modulePrincipal.RutaPrograma & "temporales/FotosProfesores/icono_fotos_personas.png") Then 
        Copy "icono_fotos_personas.png" To modulePrincipal.RutaPrograma & "temporales/FotosProfesores/icono_fotos_personas.png"
      Endif
      PictureBoxFoto.Picture = Picture[modulePrincipal.RutaPrograma & "temporales/FotosProfesores/icono_fotos_personas.png"]
      PictureBoxFoto.Tag = "icono_fotos_personas.png"
      
    Endif
  Else
    Try Copy "icono_fotos_personas.png" To modulePrincipal.RutaPrograma & "temporales/FotosProfesores/icono_fotos_personas.png"
    PictureBoxFoto.Picture = Picture[modulePrincipal.RutaPrograma & "temporales/FotosProfesores/icono_fotos_personas.png"]
    PictureBoxFoto.tag = "icono_fotos_personas.png"
  Endif
  
  TextBoxApellidos.text = reg.Apellidos
  TextBoxAsignatura.text = reg.Asignatura
  TextBoxNombre.text = reg.Nombre
  If reg.Orden = 0 Then 
    ValueBoxOrden.value = 1
  Else
    ValueBoxOrden.Value = reg.Orden
  Endif
  
  If modo = -1 Then 
    For a = 0 To ModuleGestionProfesores.Lista.registros.Max
      ValueBoxOrden.value = Max(ValueBoxOrden.value + 1, ModuleGestionProfesores.Lista.registros[a].Orden)
    Next
    
  Endif
  
  Me.center
  
End

Public Sub ToolButtonAceptar_Click()
  
  reg.Foto = Replace(PictureBoxFoto.tag, " ", "_")
  reg.Nombre = TextBoxNombre.Text
  reg.Apellidos = TextBoxApellidos.Text
  
  reg.Asignatura = TextBoxAsignatura.text
  reg.Orden = ValueBoxOrden.value 
  
  If modo = anadir Then 
    'si estoy añadiendo paso a añadir datos
    ModuleGestionProfesores.anadirRegistro(reg)
    FMain.GridViewRegistrosProfesores.rows.count += 1
    ModuleGestionProfesores.guardado = False
  Else
    ModuleGestionProfesores.EditarRegistros(reg, modo)
    ModuleGestionProfesores.guardado = False
  Endif
  
  Me.Close
  
End

Public Sub ButtonMasUno_Click()
  
  If ModuleGestionProfesores.Lista.Registros.max = -1 Then 
    
    Return
  Endif
  If modo = 0 Then Return
  reg.Orden = ModuleGestionProfesores.Lista.Registros[ModuleGestionProfesores.Lista.Registros.max].Orden + 1
  ValueBoxOrden.Value = reg.Orden
  
End

Public Sub ToolButton1_Click()
  
  Dim comando As String = ModulePrincipal.RutaPrograma & "FotoFotoCarnetMyWebCam.gambas"
  Dim nombrefinal As String
  
  Exec [comando] Wait
  '  User.home & "/webcam_carnet.png"
  nombrefinal = modulePrincipal.RutaPrograma & "temporales/FotosProfesores/" & Replace(Replace(Replace("webcam_carnet" & Str$(Now()) & ".png", " ", "_"), "/", "-"), ":", "-")
  
  Exec ["mv", User.home & "/webcam_carnet.png", nombrefinal] Wait
  
  reg.foto = ModuleIntermedio.extraedesdebarra(nombrefinal)
  PictureBoxFoto.tag = reg.foto
  PictureBoxFoto.picture = Picture[nombrefinal]
  
End
