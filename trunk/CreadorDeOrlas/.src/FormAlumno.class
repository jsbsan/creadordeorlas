' Gambas class file

Public modo As Integer  'modo añadir=-1, editar=nº de id
Public anadir As Integer = -1
Public reg As New ClassAlumno

Public Sub Form_Open()
  
  If modo > -1 Then 
    PictureBoxFoto.tag = reg.Foto
    'TODO: indicar ruta donde se guarde  las fotos
    '  PictureBoxFoto.Picture= Picture[
    
  Endif
  
  TextBoxNombre.text = reg.Nombre
  TextBoxApellidos.text = reg.Apellidos
  TextBoxProvincia.text = reg.Provincia
  TextBoxPueblo.text = reg.Pueblo
  If reg.Orden = 0 Then 
    ValueBoxOrden.value = 1
  Else
    ValueBoxOrden.value = reg.Orden
  Endif
  
Catch
  ModuleMensajeError.SistemaDescripcionError()
  
End

'----------------------------------------
' Boton Igual
'----------------------------------------

Public Sub ButtonIgualNombre_Click()
  
  Dim maximo As Integer
  Dim valor As Variant
  'se ha producido un click en el grupo de botones iguala
  
  If modo = 0 Then Return 
  
  If ModuleGestionAlumnos.lista.Registros.max = -1 Then 
    Message.Info(("Se trata del primer datos que introduces, no puede igualarlo al anterior"))
    Return
  Endif
  
  If modo = -1 Then
    maximo = ModuleGestionAlumnos.lista.Registros.Max
    If maximo = -1 Then Return
    valor = Object.GetProperty(ModuleGestionAlumnos.Lista.registros[maximo], Last.tag)
  Else
    'estoy editando un registro, me fijo en el registro anterior
    valor = Object.GetProperty(ModuleGestionAlumnos.Lista.registros[modo - 1], Last.tag)
  Endif
  
  'le paso el valor
  Object.SetProperty(reg, Last.tag, valor)  
  '  Print Object.Type(devuelvetextbox(Last.tag))
  
  Object.SetProperty(devuelvetextbox(Last.tag), "text", Object.GetProperty(reg, Last.tag))
  
End

Public Sub devuelvetextbox(texto As String) As Object
  
  Dim propiedades As String[] = ["pueblo", "provincia"]
  
  Select Case propiedades.Find(Lower(texto))
    Case 0
      Return TextBoxPueblo
    Case 1 
      Return TextBoxProvincia
  End Select
  
End

Public Sub ToolButtonAceptar_Click()
  
  reg.Foto = Replace(PictureBoxFoto.tag, " ", "_")
  reg.Nombre = TextBoxNombre.Text
  reg.Apellidos = TextBoxApellidos.Text
  
  reg.Provincia = TextBoxProvincia.text 
  reg.Pueblo = TextBoxPueblo.text 
  reg.Orden = ValueBoxOrden.value 
  
  If modo = anadir Then 
    'si estoy añadiendo paso a añadir datos
    ModuleGestionAlumnos.anadirRegistro(reg)
    FMain.GridViewRegistrosAlumnos.rows.count += 1
    ModuleGestionAlumnos.guardado = False
  Else
    ModuleGestionAlumnos.EditarRegistros(reg, modo)
    ModuleGestionAlumnos.guardado = False
  Endif
  
  Me.Close
  
End

Public Sub ButtonMasUno_Click()
  
  If ModuleGestionAlumnos.Lista.Registros.max = -1 Then 
    
    Return
  Endif
  If modo = 0 Then Return
  reg.Orden = ModuleGestionAlumnos.Lista.Registros[ModuleGestionAlumnos.Lista.Registros.max].Orden + 1
  ValueBoxOrden.Value = reg.Orden
  
End
