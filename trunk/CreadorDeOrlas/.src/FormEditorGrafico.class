' Gambas class file

Public cambiosRealizado As Boolean
Public plantillaActual As String 
Public mini As New ClassMiniMapa
Public imagenfondo As String
Public himagenF As Image

Public coeficiente As Float = 1.0

Public anchoinicial As String
Public altoinicial As String
Public distancia As Float
Public distanciah As Float
Public himagenH As New Image
Public himagenV As New Image
Public himagenMini As New Image

Public ArrayFotosRectangulos As New ClassRectanguloFijo[]

Public Sub Form_Open()
  
  Dim rectangulo As ClassRectanguloFijo
  
  himagenH = Image.Load("dibujos/Editor/barra420.png")
  himagenV = Image.Load("dibujos/Editor/barra297.png")
  
  cambiosRealizado = True
  imagenfondo = User.home & "/temoralFondo.png"  
  Exec ["inkscape", plantillaActual, "--export-png", imagenfondo] Wait
  
  'quito colores
  'Exec ["convert", "-colors", "256", imagenfondo, imagenfondo] Wait
  mini.imagenF = Image.Load(imagenfondo)
  mini.configuro(ScrollViewVentana, DrawingAreaMayor, MinimapObjeto, 1)
  
  himagenF = Image.Load(imagenfondo)
  anchoinicial = DrawingAreaMayor.W
  altoinicial = DrawingAreaMayor.h
  distancia = Int(2410 / 21)
  distanciaH = Int(1680 / 14)
  
  rectangulo = New ClassRectanguloFijo(DrawingAreaMayor, 20, 20, 143, 183)
  rectangulo.nombre = "Julio"
  rectangulo.apellidos = "Sanchez Berro"
  rectangulo.oficio = "alumno"
  rectangulo.coeficiente = 1
  rectangulo.xinicial = 20
  rectangulo.yinicial = 20
  
  ArrayFotosRectangulos.Add(rectangulo)
  
  rectangulo = New ClassRectanguloFijo(DrawingAreaMayor, 150, 20, 143, 183)
  rectangulo.nombre = "Javier"
  rectangulo.apellidos = "Calle"
  rectangulo.oficio = "profesor"
  rectangulo.coeficiente = 1
  rectangulo.xinicial = 150
  rectangulo.yinicial = 20
  ArrayFotosRectangulos.Add(rectangulo)
  
  mini.annadeRectanguloRellenos(ArrayFotosRectangulos)
  
End

Public Sub form_Show()
  
End

Public Sub Form_Resize()
  
  cambiosRealizado = True
  'si se modifica el tamaño del formulario, tambien se modifica el tamaño de View
  ScrollViewVentana.h = Me.H - (20)
  ScrollViewVentana.w = Me.w - (861 - 546)
  mini.configuro(ScrollViewVentana, DrawingAreaMayor, MinimapObjeto, coeficiente) ', imagenfondo)
  cambiosRealizado = True
  
End

'------------------------------- usando la clase classMiniMapa
'
Public Sub MinimapObjeto_MouseMove()
  
  cambiosRealizado = True
  mini.movimientoRaton(mouse.x, mouse.y)
  
End

Public Sub ScrollViewVentana_Scroll()
  
  cambiosRealizado = True
  mini.movimientoVentana()
  
End

'Dibujar contenido en el drawinAreaMayor

Public Sub TimerActualizarDibujo_Timer()
  
  Dim hbrush As PaintBrush
  Dim a As Integer
  
  Paint.Begin(DrawingAreaMayor)
  'dibujar esquema fotos
  
  '    If cambiosRealizado = False Then Return 
  borradoPantalla()
  
  If CheckBoxFondo.value = True Then
    hbrush = paint.Image(himagenF)
    hbrush.Translate(25, 35)
    hbrush.Scale(DrawingAreaMayor.w / himagenF.w * coeficiente, DrawingAreaMayor.w / himagenF.w * coeficiente) '(200 / himage.w, 200 / himage.h)
    Paint.Brush = hbrush
    Paint.Rectangle(ScrollViewVentana.scrollx, ScrollViewVentana.scrolly, ScrollViewVentana.w * coeficiente, ScrollViewVentana.h * coeficiente)
    
    '   ScrollViewVentana.ScrollX, ScrollViewVentana.scrolly, ScrollViewVentana.w, ScrollViewVentana.h
    Paint.Fill()
    
  Endif
  
  If CheckBoxRejilla.Value = True Then 
    distancia = (DrawingAreaMayor.w / 21 * coeficiente)
    distanciaH = (DrawingAreaMayor.h / 14 * coeficiente)
    For a = 0 To 22
      paint.LineWidth = 1
      paint.Brush = paint.Color(Color.blue)
      paint.MoveTo(25 + a * distancia, DrawingAreaMayor.h * coeficiente)
      paint.LineTo(25 + a * distancia, 0)
      paint.Stroke()
    Next
    For a = 0 To 15
      paint.LineWidth = 1
      paint.Brush = paint.Color(Color.blue)
      paint.MoveTo(0, 25 + a * distancia)
      paint.LineTo(DrawingAreaMayor.w * coeficiente, 25 + a * distancia)
      paint.Stroke()
    Next
  Endif
  
  If CheckBoxReglas.value = True Then 
    hbrush = Paint.Image(himagenH)
    hbrush.Translate(25, 75 + ScrollViewVentana.Scrolly)
    hbrush.Scale(DrawingAreaMayor.w / himagenH.w * coeficiente, DrawingAreaMayor.w / himagenH.w * coeficiente) '(200 / himage.w, 200 / himage.h)
    Paint.Brush = hbrush
    Paint.Rectangle(ScrollViewVentana.Scrollx, ScrollViewVentana.Scrolly, ScrollViewVentana.w, himagenH.h)
    Paint.Fill()
    
    hbrush = Paint.Image(himagenV)
    hbrush.Translate(0, DrawingAreaMayor.y * coeficiente + 30) '30 para 210
    hbrush.Rotate(Pi / 2)
    hbrush.Scale(DrawingAreaMayor.h / himagenv.w * coeficiente, DrawingAreaMayor.h / himagenv.w * coeficiente) '(200 / himage.w, 200 / himage.h)
    Paint.Brush = hbrush
    Paint.Rectangle(ScrollViewVentana.ScrollX, ScrollViewVentana.Scrolly, 30, ScrollViewVentana.h * coeficiente) '1230 para -> 210
    Paint.Fill()
  Endif
  
  For a = 0 To ArrayFotosRectangulos.count - 1
    ArrayFotosRectangulos[a].dibuja()
    
  Next
  
  Paint.End
  cambiosRealizado = False
  
End

Public Sub DrawingAreaMayor_Draw()
  
End

Public Sub borradoPantalla()
  
  '  If CheckBoxFondo.value = True Then Return 
  
  'dibujo un rectangulo blanco
  paint.Rectangle(ScrollViewVentana.ScrollX, ScrollViewVentana.scrolly, ScrollViewVentana.w, ScrollViewVentana.h) '1250 para -> 210
  Paint.LineWidth = 0.1
  Paint.Brush = Paint.Color(Color.white)
  Paint.Fill(True)
  
  paint.Stroke
  
End

Public Sub ToolButtonZoomInicial_Click()
  
  Dim a As Integer
  
  coeficiente = 1
  For a = 0 To ArrayFotosRectangulos.count - 1
    ArrayFotosRectangulos[a].coeficiente = 1
    ArrayFotosRectangulos[a].pto1.x = ArrayFotosRectangulos[a].xinicial
    ArrayFotosRectangulos[a].pto1.y = ArrayFotosRectangulos[a].yinicial
    
  Next
  cambiosRealizado = True
  mini.configuro(ScrollViewVentana, DrawingAreaMayor, MinimapObjeto, coeficiente)
  mini.movimientoVentana()
  
End

Public Sub ToolButtonZoomMas_Click()
  
  Dim a As Integer
  
  coeficiente += 0.05
  For a = 0 To ArrayFotosRectangulos.count - 1
    ArrayFotosRectangulos[a].coeficiente += 0.05
    
  Next
  cambiosRealizado = True
  mini.configuro(ScrollViewVentana, DrawingAreaMayor, MinimapObjeto, coeficiente)
  mini.movimientoVentana()
  
End

Public Sub ToolButtonZoomMenos_Click()
  
  Dim a As Integer
  
  coeficiente -= 0.05
  For a = 0 To ArrayFotosRectangulos.count - 1
    ArrayFotosRectangulos[a].coeficiente -= 0.05
    
  Next
  cambiosRealizado = True
  mini.configuro(ScrollViewVentana, DrawingAreaMayor, MinimapObjeto, coeficiente)
  mini.movimientoVentana()
  
End

Public Sub CheckBoxRejilla_Click()
  
  cambiosRealizado = True
  
End

Public Sub CheckBoxFondo_Click()
  
  cambiosRealizado = True
  
End

Public Sub CheckBoxReglas_Click()
  
  cambiosRealizado = True
  
End

Public Sub ToolButtonRedibuja_Click()
  
  mini.configuro(ScrollViewVentana, DrawingAreaMayor, MinimapObjeto, coeficiente)
  
End

Public Sub Frame1_MouseDown()
  
End
